<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Observer pattern</title>
</head>
<body>
    <input type="text" id="multiUseInput">
    <ul id="tagGroup">
    </ul>
<script>
/**
* author : jang jeong sik
* use : If you get comma during text input
*       remove to click item
**/
    var regstTag = (function(){
        var store = [];
        var doc = document;
        var fragment = doc.createDocumentFragment();
        var target;
        var tagGroup = doc.getElementById('tagGroup');
        var whiteList = /<(?!a|br)[^>]*>/gi;
        var pattern = /[,]/g;

        var getWords = function(){
            var value = this.value;
            var tag;

            if(whiteList.test(value)){
                throw new Error("don't use that literal!!");
                return false;
            }

            if(pattern.test(value)){
                tag = setFragment(value);

                tagGroup.appendChild(tag);
                store.push(tag);

                tag.addEventListener('click', removeTagItem, false);

                this.value = '';
                this.focus();
            }
        };

        var setFragment = function(value){
            var el = createTagList();

            el.anchor.textContent = value.split(',')[0];
            el.li.appendChild(el.anchor);

            return el.li;
        };

        var createTagList = function(){
            return {
                li : doc.createElement('li'),
                anchor : doc.createElement('a')
            }
        };

        var removeTagItem = function(e){
            var target = e.target.tagName.toLowerCase() === 'a' ? e.target.parentNode : e.target;
            var index = store.indexOf(target);

            if(index > -1){
                store[index].removeEventListener('click', removeTagItem, false);
                store.splice(index, 1);
            }

            tagGroup.innerHTML = '';
            updateTagGroup();
        };

        var updateTagGroup = function(){
            var len = store.length;
            var iterate = 0;

            while(len > iterate){
                fragment.appendChild(store[iterate]);
                iterate++;
            }

            tagGroup.appendChild(fragment);
        };

        var putData = function(){
            /**
            $.ajax({
                method : 'GET or POST',
                url : '',
                data : { tags : store.join(',') }
                success : function(){

                },
                complete : function(){

                },
                error : function(e){
                    console.log(e);
                }
            })
            **/
        }

        return {
            init : function(id){
                target = doc.getElementById(id);
                target.addEventListener('keyup', getWords, false);
            }
        }
    })();

    regstTag.init('multiUseInput');
</script>
</body>
</html>
