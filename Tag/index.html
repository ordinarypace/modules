<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Observer pattern</title>
</head>
<body>
    <input type="text" id="multiUseInput">
    <ul id="tagGroup">
    </ul>
<script>
/**
* author : jang jeong sik
* use : If you get comma during text input
*       remove to click item
**/
    var regstTag = (function(){
        var MAXLENGTH = 10;

        var store = [];
        var keyword = [];
        var doc = document;
        var fragment = doc.createDocumentFragment();
        var target;
        var tagGroup = doc.getElementById('tagGroup');
        var whiteList = /<(?!a|br)[^>]*>/gi;
        var pattern = /[,]/g;

        if(store.length === MAXLENGTH){
            alert("Can't register more than 10");
        }

        var getWords = function(){
            var value = this.value;
            var tag;

            if(whiteList.test(value)){
                throw new Error("Don't use that literal!!");
                initInput(this);

                return false;
            }

            if(pattern.test(value)){
                value = value.split(',')[0];

                if(compareStore(value) > -1){
                    console.log('This tag is already registered');
                    initInput(this);

                    return false;
                }

                addTagItem(setFragment(value), value.trim(), this);
            }
        };

        var initInput = function(context){
            context.value = '';
            context.focus();
        };

        var setFragment = function(value){
            var el = createTagList();

            el.anchor.textContent = '#' + value;
            el.li.appendChild(el.anchor);

            return el.li;
        };

        var createTagList = function(){
            return {
                li : doc.createElement('li'),
                anchor : doc.createElement('a')
            }
        };

        var addTagItem = function(tag, value, context){
            tagGroup.appendChild(tag);
            store.push(tag);
            keyword.push(value.trim());

            tag.addEventListener('click', removeTagItem, false);

            initInput(context);
        };

        var removeTagItem = function(e){
            var target = e.target.tagName.toLowerCase() === 'a' ? e.target.parentNode : e.target;
            var index = store.indexOf(target);

            if(index > -1){
                store[index].removeEventListener('click', removeTagItem, false);
                store.splice(index, 1);
                keyword.splice(index, 1);
            }

            tagGroup.innerHTML = '';
            updateTagGroup();
        };

        var updateTagGroup = function(){
            var len = store.length;
            var iterate = 0;

            while(len > iterate){
                fragment.appendChild(store[iterate]);
                iterate++;
            }

            tagGroup.appendChild(fragment);
        };

        var putData = function(){
            /**
            $.ajax({
                method : 'GET or POST',
                url : '',
                data : { tags : keyword.join(',') }
                success : function(){

                },
                complete : function(){

                },
                error : function(e){
                    console.log(e);
                }
            })
            **/
        };

        var compareStore = function(value){
            return keyword.indexOf(value);
        };

        return {
            init : function(id){
                target = doc.getElementById(id);
                target.addEventListener('keyup', getWords, false);
            },
            putData : putData
        }
    })();

    regstTag.init('multiUseInput');
</script>
</body>
</html>
